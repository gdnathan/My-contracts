const { ethers } = require("ethers");
const hre = require("hardhat");

async function main() {

  const [deployer] = await hre.ethers.getSigners();
  // const contract = await hre.ethers.getContractFactory("L1XBridge");
  // const deployed = await contract.deploy([deployer]);
  //
  const mock = await hre.ethers.getContractFactory("MockContract");
  const depl = await mock.deploy();
  // const mock_address = await depl.getAddress();

  const Bridge = await hre.ethers.getContractFactory("L1XBridge");
  const bridge = Bridge.attach("0x99eb1a9fa66a18f83b0ace60c3defa369ef39525");

  const tx_hash = "0xd0b4e7b98b495d7d6b0fc614eedaa9a8ca6996184ab585732826ce2b718d99df";
  const r = await deployer.provider.getTransactionReceipt(tx_hash)

  // console.log(r)
  // console.log(r.logs[0])

  const decoded = bridge.interface.decodeEventLog("FailedCrossContractCall", r.logs[0].data)
  const payload = decoded[1]

  console.log("contract address: ", decoded[0]);
  const hex = ethers.getBytes(payload);
  console.log(depl.interface.decodeFunctionData("executeSwap", hex));




  // hex
  // const payload = "0x6d32be5a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000090b4c303bf1e13b91213a8dc34768b0d1c3308c10000000000000000000000004da3a083831d9863b0c2be734c351e6c0cf83fad00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010066653c1d6b39ad1ca3457ba9b27360a129d449152c2998e72b2c21a2f32487970000000000000000000000000000000000000000000000000000000000000004555344540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000075345504f4c494100000000000000000000000000000000000000000000000000"
  // const payload = "0x6d32be5a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000090b4c303bf1e13b91213a8dc34768b0d1c3308c10000000000000000000000004da3a083831d9863b0c2be734c351e6c0cf83fad00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010066654c1d6b39ad1ca3457ba9b27360a129d449152c2998e72b2c21a2f32487970000000000000000000000000000000000000000000000000000000000000004555344540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000075345504f4c494100000000000000000000000000000000000000000000000000"
  const payload_hash = "53866072748713689100985500294431303918904197292482661089029642060357415779417"
  const weird_payload = "77171de3876fc31f31226935319901fa47288c42197484be10d248432914bc59"

  const signature1 = "fa877846b8d417721b50fb0727ee074654544b881d25da8d0517348f12c58c4f135c782094eada035228188112e022f3106e377803125a157f4b01676a6535f11c";
  const signature2 = "fe8c9274433046e4ec686ad4face926683f3f590ec96d4efafd5693e19df2082677c686520ce36fdca46186414731a6db77c7f99d4360c315081c41691749a101b";


  const full_raw_hex_payload = "0xb6f3b38866654c1d6b39ad1ca3457ba9b27360a129d449152c2998e72b2c21a2f324879700000000000000000000000000000000000000000000000000000000000000800000000000000000000000000a6e8959960edfe556d7ea4f1d7994560ead560e000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001446d32be5a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000090b4c303bf1e13b91213a8dc34768b0d1c3308c10000000000000000000000004da3a083831d9863b0c2be734c351e6c0cf83fad00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010066654c1d6b39ad1ca3457ba9b27360a129d449152c2998e72b2c21a2f32487970000000000000000000000000000000000000000000000000000000000000004555344540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000075345504f4c494100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000041b1bc7c73b977e3e8c23b452ac2415e51981c5744c77fae550e0fc98f1271eb6f3f10f6358e576f91e04096c730672b1c87cd369718fe8b0cdb17dac03ca4d1cb1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041d26a47e206bed7b913e2feddc01495953835e037aea19455eba6ffcf519d3da244930308c1d602a4fc1a8688499d3460a1d8ea19fd6dbfc567cf52e21e9f19111b00000000000000000000000000000000000000000000000000000000000000"

  // const abiData = await deployedContract.bytecode();
  // const abi = ethers.
  //
  //   const e = abi.





  // const hex = ethers.getBytes(payload);
  // console.log(depl.interface.decodeFunctionData("executeSwap", hex));
  //
  // const hex2 = ethers.getBytes(full_raw_hex_payload);
  // const fn_data = deployed.interface.decodeFunctionData("entrypoint", hex2);
  // console.log(fn_data);
  //
  //   const a = ethers.AbiCoder
  // // console.log(fn_data[0]);
  // // console.log(fn_data[1]);
  // // console.log(fn_data[2]);
  // // console.log(fn_data[3]);
  // const tx = await deployed.entrypoint(hex2)
  // let receipt = await tx.wait();
  // console.log(receipt);


  // let tx = await deployed.interface.parseTransaction({data: payload});
  // console.log(tx);

  // let tx = await deployed.direct_call(payload, mock_address);
  // let receipt = await tx.wait();
  // // const returnValue = ethers.defaultAbiCoder   decode(['bool'], receipt.logs[0].data)
  // const returnValue = deployed.interface.decodeFunctionResult("direct_call", receipt.logs[0].data);
  // console.log(returnValue);

}


main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
